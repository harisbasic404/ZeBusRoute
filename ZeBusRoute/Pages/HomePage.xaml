<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:maps="clr-namespace:Microsoft.Maui.Controls.Maps;assembly=Microsoft.Maui.Controls.Maps"
             xmlns:vm="clr-namespace:ZeBusRoute.ViewModels"
             xmlns:models="clr-namespace:ZeBusRoute.Models"
             x:Class="ZeBusRoute.Pages.HomePage"
             x:DataType="vm:HomeViewModel"
             Title="ZeBusRoute"
             BackgroundColor="White">

    <Grid RowDefinitions="Auto,Auto,Auto,*"
          RowSpacing="0"
          Padding="0">

        <!-- Header -->
        <Grid Grid.Row="0"
              BackgroundColor="#8BC34A"
              Padding="16,12"
              ColumnDefinitions="*,Auto"
              VerticalOptions="Center">
            <Label Text="ZeBusRoute"
                   FontSize="20"
                   FontAttributes="Bold"
                   TextColor="White"
                   VerticalOptions="Center"
                   HorizontalOptions="Start"/>
            <Button Grid.Column="1"
                    BackgroundColor="Transparent"
                    ImageSource="settings.png"
                    WidthRequest="32"
                    HeightRequest="32"
                    HorizontalOptions="End"
                    VerticalOptions="Center"/>
        </Grid>

        <!-- Search Bar (custom, rounded) -->
        <Grid Grid.Row="1" Padding="16,8">
            <Border Stroke="#D6D6D6"
                    StrokeThickness="1"
                    BackgroundColor="White"
                    Padding="14,10"
                    HeightRequest="54">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="24" />
                </Border.StrokeShape>
                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8" VerticalOptions="Center">
                    <Image Source="search.png"
                           WidthRequest="18"
                           HeightRequest="18"
                           VerticalOptions="Center"
                           Opacity="0.6"/>
                    <Entry Placeholder="Pretraži linije..."
                           PlaceholderColor="#9E9E9E"
                           TextColor="#333333"
                           BackgroundColor="Transparent"
                           FontSize="14"
                           ClearButtonVisibility="WhileEditing"
                           VerticalOptions="Center"
                           VerticalTextAlignment="Center"
                           TextChanged="OnSearchTextChanged"/>
                </Grid>
            </Border>
        </Grid>

        <!-- Favorites chips -->
        <VerticalStackLayout Grid.Row="2" Spacing="6" Padding="16,0,16,8">
            <Label Text="Omiljene linije"
                   FontSize="12"
                   TextColor="#6A6A6A"/>
            <Label Text="Nema omiljenih linija. Dodaj na Routes page."
                   FontSize="12"
                   TextColor="#9E9E9E"
                   IsVisible="{Binding HasNoFavorites}"/>
            <CollectionView ItemsSource="{Binding FilteredFavoriteLines}"
                            ItemsLayout="HorizontalList"
                            HeightRequest="52"
                            IsVisible="{Binding HasFavorites}">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Linija">
                        <Button Text="{Binding Naziv}"
                                FontSize="14"
                                Padding="12,8"
                                BackgroundColor="#E8F5E8"
                                TextColor="#2E7D32"
                                CornerRadius="20"
                                BorderColor="#8BC34A"
                                BorderWidth="1"
                                Clicked="OnFavoriteLineClicked" />
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>

        <!-- Map -->
        <maps:Map Grid.Row="3"
                  x:Name="BusMap"
                  MapType="Street"
                  IsShowingUser="True"
                  IsTrafficEnabled="False"
                  HorizontalOptions="FillAndExpand"
                  VerticalOptions="FillAndExpand"
                  BackgroundColor="#F5F5F5">
            <maps:Map.Pins>
                <maps:Pin Label="Centar"
                          Address="Zenica Centar"
                          Type="Generic" />
                <maps:Pin Label="Gradska Vijećnica"
                          Address="Zenica Vijećnica"
                          Type="Generic" />
            </maps:Map.Pins>
        </maps:Map>

    </Grid>
</ContentPage>

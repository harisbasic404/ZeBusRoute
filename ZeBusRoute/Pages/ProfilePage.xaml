<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:ZeBusRoute.ViewModels"
             xmlns:converters="clr-namespace:ZeBusRoute.Converters"
             x:Class="ZeBusRoute.Pages.ProfilePage"
             Title="Profil"
             BackgroundColor="{DynamicResource BojaPozadine}">
    <ContentPage.Resources>
        <Color x:Key="ZelenaPrimarna">#66BB6A</Color>
        <Color x:Key="ZelenaDugme">#4CAF50</Color>
        <Color x:Key="SivaSvijetla">#F5F5F5</Color>
        <Color x:Key="SivaKartica">#FFFFFF</Color>
        <Color x:Key="SivaTekst">#777777</Color>
        <Color x:Key="SivaDivider">#EEEEEE</Color>
        <Color x:Key="BojaPozadine">#FAFAFA</Color>

        <Style TargetType="Button" x:Key="PrimarnoDugme">
            <Setter Property="BackgroundColor" Value="{StaticResource ZelenaDugme}"/>
            <Setter Property="TextColor" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="22,12"/>
            <Setter Property="HorizontalOptions" Value="Center"/>
            <Setter Property="WidthRequest" Value="180"/>
        </Style>
        <Style TargetType="Button" x:Key="SekundarnoDugme">
            <Setter Property="BackgroundColor" Value="White"/>
            <Setter Property="BorderColor" Value="#BBBBBB"/>
            <Setter Property="BorderWidth" Value="1"/>
            <Setter Property="TextColor" Value="#333333"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="22,12"/>
            <Setter Property="HorizontalOptions" Value="Center"/>
            <Setter Property="WidthRequest" Value="180"/>
        </Style>
        <Style TargetType="Frame" x:Key="KarticaStil">
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="HasShadow" Value="False"/>
            <Setter Property="BackgroundColor" Value="{StaticResource SivaKartica}"/>
            <Setter Property="BorderColor" Value="#DDDDDD"/>
            <Setter Property="Margin" Value="16,10"/>
            <Setter Property="Padding" Value="0"/>
        </Style>
        <Style TargetType="Grid" x:Key="StavkaPostavke">
            <Setter Property="Padding" Value="16"/>
            <Setter Property="ColumnDefinitions" Value="Auto,* ,Auto"/>
        </Style>

        <ResourceDictionary>
            <!-- existing resources -->
            <converters:InverseBoolConverter x:Key="InverseBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ContentPage.BindingContext>
        <vm:ProfileViewModel />
    </ContentPage.BindingContext>

    <ScrollView>
        <VerticalStackLayout Spacing="0">

            <!-- Header -->
            <Grid BackgroundColor="{StaticResource ZelenaPrimarna}" HeightRequest="56" Padding="16,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Image Source="profile_icon.png" WidthRequest="20" HeightRequest="20" VerticalOptions="Center" Margin="0,0,8,0"/>
                <Label Text="Profil" Grid.Column="1" TextColor="White" FontSize="16" VerticalOptions="Center"/>
            </Grid>

            <!-- Hero sekcija -->
            <VerticalStackLayout Padding="0,24" Spacing="10" BackgroundColor="White">
                <Frame WidthRequest="110" HeightRequest="110" CornerRadius="55" BackgroundColor="#E8F5E9" Padding="0" HasShadow="False" HorizontalOptions="Center">
                    <Image Source="profile_avatar.png" WidthRequest="44" HeightRequest="44" HorizontalOptions="Center" VerticalOptions="Center"/>
                </Frame>

                <!-- NEPRIJAVLJEN -->
                <VerticalStackLayout Spacing="8" IsVisible="{Binding JePrijavljen, Converter={StaticResource InverseBoolConverter}}">
                    <Label Text="Dobrodošli u ZeBusRoute" FontAttributes="Bold" FontSize="20" TextColor="#222" HorizontalOptions="Center"/>
                    <Label Text="Prijavite se da sačuvate favorite i kupujete karte" FontSize="14" TextColor="{StaticResource SivaTekst}" HorizontalOptions="Center"/>
                    <VerticalStackLayout Spacing="8" Padding="0,6">
                        <Button Style="{StaticResource PrimarnoDugme}" Text="Prijava" Command="{Binding OtvoriPrijavuKomanda}"/>
                        <Button Style="{StaticResource SekundarnoDugme}" Text="Registracija" Command="{Binding OtvoriRegistracijuKomanda}"/>
                    </VerticalStackLayout>
                </VerticalStackLayout>

                <!-- PRIJAVLJEN -->
                <VerticalStackLayout Spacing="6" IsVisible="{Binding JePrijavljen}">
                    <Label Text="{Binding Korisnik.ImePrezime}" FontAttributes="Bold" FontSize="18" HorizontalOptions="Center"/>
                    <Label Text="{Binding Korisnik.Email}" FontSize="14" TextColor="{StaticResource SivaTekst}" HorizontalOptions="Center"/>
                    <Label Text="{Binding Korisnik.BrojTelefona}" FontSize="14" TextColor="{StaticResource SivaTekst}" HorizontalOptions="Center"/>
                    <HorizontalStackLayout Spacing="10" HorizontalOptions="Center" Padding="0,8,0,0">
                        <Button Style="{StaticResource SekundarnoDugme}" Text="Uredi profil" Command="{Binding OtvoriUrediProfilKomanda}"/>
                        <Button BackgroundColor="#E53935" TextColor="White" CornerRadius="8" Padding="22,12" Text="Odjava" Command="{Binding OdjavaKomanda}"/>
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </VerticalStackLayout>

            <!-- Settings header -->
            <Grid BackgroundColor="{StaticResource SivaSvijetla}" Padding="16,10">
                <Label Text="Postavke" FontAttributes="Bold" FontSize="14" TextColor="#666"/>
            </Grid>

            <!-- Settings card -->
            <Frame Style="{StaticResource KarticaStil}">
                <VerticalStackLayout Spacing="0">
                    <!-- Jezik -->
                    <Grid Style="{StaticResource StavkaPostavke}">
                        <Image Source="globe_icon.png" WidthRequest="20" HeightRequest="20" Margin="0,0,12,0"/>
                        <VerticalStackLayout Grid.Column="1" Spacing="2">
                            <Label Text="Jezik" FontAttributes="Bold" FontSize="16"/>
                            <Label Text="Bosanski" TextColor="{StaticResource SivaTekst}" FontSize="13"/>
                        </VerticalStackLayout>
                    </Grid>
                    <BoxView HeightRequest="1" BackgroundColor="{StaticResource SivaDivider}"/>

                    <!-- Tamni režim -->
                    <Grid Style="{StaticResource StavkaPostavke}">
                        <VerticalStackLayout Grid.Column="1" Spacing="2">
                            <Label Text="Tamni režim" FontAttributes="Bold" FontSize="16"/>
                            <Label Text="Uključi tamni prikaz" FontSize="13" TextColor="{StaticResource SivaTekst}"/>
                        </VerticalStackLayout>
                        <Switch Grid.Column="2" IsToggled="{Binding JeTamniRežim}" Toggled="OnPromjenaTamniMod"/>
                    </Grid>
                    <BoxView HeightRequest="1" BackgroundColor="{StaticResource SivaDivider}"/>

                    <!-- Obavijesti -->
                    <Grid Style="{StaticResource StavkaPostavke}">
                        <VerticalStackLayout Grid.Column="1" Spacing="2">
                            <Label Text="Obavijesti" FontAttributes="Bold" FontSize="16"/>
                            <Label Text="Kašnjenja i novosti" FontSize="13" TextColor="{StaticResource SivaTekst}"/>
                        </VerticalStackLayout>
                        <Switch Grid.Column="2" IsToggled="{Binding ObavijestiUkljucene}"/>
                    </Grid>
                    <BoxView HeightRequest="1" BackgroundColor="{StaticResource SivaDivider}"/>

                    <!-- O aplikaciji -->
                    <Grid Style="{StaticResource StavkaPostavke}">
                        <Image Source="info_icon.png" WidthRequest="20" HeightRequest="20" Margin="0,0,12,0"/>
                        <VerticalStackLayout Grid.Column="1" Spacing="2">
                            <Label Text="O aplikaciji" FontAttributes="Bold" FontSize="16"/>
                            <Label Text="Verzija 1.0.0" TextColor="{StaticResource SivaTekst}" FontSize="13"/>
                        </VerticalStackLayout>
                    </Grid>
                </VerticalStackLayout>
            </Frame>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
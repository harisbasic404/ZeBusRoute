<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:ZeBusRoute.ViewModels"
             xmlns:converters="clr-namespace:ZeBusRoute.Converters"
             x:Class="ZeBusRoute.Pages.ProfilePage"
             Title="Profil"
             BackgroundColor="{DynamicResource BojaPozadine}">
    <ContentPage.Resources>
        <!-- Sve zelene usklađene na #7CB342 -->
        <Color x:Key="ZelenaPrimarna">#7CB342</Color>
        <Color x:Key="ZelenaDugme">#7CB342</Color>
        <Color x:Key="SivaSvijetla">#F5F5F5</Color>
        <Color x:Key="SivaKartica">#FFFFFF</Color>
        <Color x:Key="SivaTekst">#777777</Color>
        <Color x:Key="SivaDivider">#EEEEEE</Color>
        <Color x:Key="BojaPozadine">#FAFAFA</Color>

        <Style TargetType="Button" x:Key="PrimarnoDugme">
            <Setter Property="BackgroundColor" Value="{StaticResource ZelenaDugme}"/>
            <Setter Property="TextColor" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="22,12"/>
            <Setter Property="HorizontalOptions" Value="Center"/>
            <Setter Property="WidthRequest" Value="180"/>
        </Style>
        <Style TargetType="Button" x:Key="SekundarnoDugme">
            <Setter Property="BackgroundColor" Value="White"/>
            <Setter Property="BorderColor" Value="#BBBBBB"/>
            <Setter Property="BorderWidth" Value="1"/>
            <Setter Property="TextColor" Value="#333333"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="22,12"/>
            <Setter Property="HorizontalOptions" Value="Center"/>
            <Setter Property="WidthRequest" Value="180"/>
        </Style>
        <Style TargetType="Frame" x:Key="CardFrameStyle">
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="BackgroundColor" Value="#F5F5F5"/>
            <Setter Property="HasShadow" Value="True"/>
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="Margin" Value="0,8"/>
        </Style>
        <Style TargetType="Grid" x:Key="CardGrid">
            <Setter Property="ColumnDefinitions" Value="Auto,*,Auto"/>
            <Setter Property="ColumnSpacing" Value="16"/>
        </Style>

        <ResourceDictionary>
            <converters:InverseBoolConverter x:Key="InverseBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ContentPage.BindingContext>
        <vm:ProfileViewModel />
    </ContentPage.BindingContext>

    <ScrollView>
        <VerticalStackLayout Spacing="0">

            <!-- Header -->
            <Grid BackgroundColor="{StaticResource ZelenaPrimarna}" HeightRequest="56" Padding="16,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Image Source="profile_icon.png" WidthRequest="20" HeightRequest="20" VerticalOptions="Center" Margin="0,0,8,0"/>
                <Label Text="Profil" Grid.Column="1" TextColor="White" FontSize="28" VerticalOptions="Center"/>
            </Grid>

            <!-- Hero sekcija -->
            <VerticalStackLayout Padding="0,24" Spacing="10" BackgroundColor="White">
                <Frame WidthRequest="110"
                       HeightRequest="110"
                       CornerRadius="55"
                       BackgroundColor="#E8F5E9"
                       Padding="0"
                       HasShadow="False"
                       HorizontalOptions="Center">
                    <Image WidthRequest="110"
                           HeightRequest="110"
                           Aspect="AspectFill"
                           HorizontalOptions="Center"
                           VerticalOptions="Center">
                        <Image.Style>
                            <Style TargetType="Image">
                                <Setter Property="Source" Value="{Binding Korisnik.SlikaPutanja}"/>
                                <Style.Triggers>
                                    <DataTrigger TargetType="Image"
                                                 Binding="{Binding Korisnik.SlikaPutanja}"
                                                 Value="">
                                        <Setter Property="Source" Value="profile_avatar.png"/>
                                    </DataTrigger>
                                    <DataTrigger TargetType="Image"
                                                 Binding="{Binding Korisnik.SlikaPutanja}"
                                                 Value="{x:Null}">
                                        <Setter Property="Source" Value="profile_avatar.png"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Image.Style>
                    </Image>
                </Frame>

                <!-- NEPRIJAVLJEN -->
                <VerticalStackLayout Spacing="8" IsVisible="{Binding JePrijavljen, Converter={StaticResource InverseBoolConverter}}">
                    <Label Text="Dobrodošli u ZeBusRoute" FontAttributes="Bold" FontSize="20" TextColor="#222" HorizontalOptions="Center"/>
                    <Label Text="Prijavite se da sačuvate favorite i kupujete karte" FontSize="14" TextColor="{StaticResource SivaTekst}" HorizontalOptions="Center"/>
                    <VerticalStackLayout Spacing="8" Padding="0,6">
                        <Button Style="{StaticResource PrimarnoDugme}" Text="Prijava" Command="{Binding OtvoriPrijavuKomanda}"/>
                        <Button Style="{StaticResource SekundarnoDugme}" Text="Registracija" Command="{Binding OtvoriRegistracijuKomanda}"/>
                    </VerticalStackLayout>
                </VerticalStackLayout>

                <!-- PRIJAVLJEN -->
                <VerticalStackLayout Spacing="6" IsVisible="{Binding JePrijavljen}">
                    <Label Text="{Binding Korisnik.ImePrezime}" FontAttributes="Bold" FontSize="18" HorizontalOptions="Center"/>
                    <Label Text="{Binding Korisnik.Email}" FontSize="14" TextColor="{StaticResource SivaTekst}" HorizontalOptions="Center"/>
                    <Label Text="{Binding Korisnik.BrojTelefona}" FontSize="14" TextColor="{StaticResource SivaTekst}" HorizontalOptions="Center"/>
                    <HorizontalStackLayout Spacing="10" HorizontalOptions="Center" Padding="0,8,0,0">
                        <Button Style="{StaticResource SekundarnoDugme}" Text="Uredi profil" Command="{Binding OtvoriUrediProfilKomanda}"/>
                        <Button BackgroundColor="#E53935" TextColor="White" CornerRadius="8" Padding="22,12" Text="Odjava" Command="{Binding OdjavaKomanda}"/>
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </VerticalStackLayout>

            <!-- Settings header -->
            <Grid BackgroundColor="{StaticResource SivaSvijetla}" Padding="16,10">
                <Label Text="Settings"
                       FontAttributes="Bold"
                       FontSize="14"
                       TextColor="#666"/>
            </Grid>

            <!-- Settings Section -->
            <VerticalStackLayout x:Name="SettingsSection" Margin="16,0,16,16" Spacing="0">

                <!-- Language Card -->
                <Frame Style="{StaticResource CardFrameStyle}">
                    <Grid Style="{StaticResource CardGrid}">
                        <Image Source="internet.png"
                               WidthRequest="24"
                               HeightRequest="24"
                               Grid.Column="0"
                               VerticalOptions="Center"/>
                        <VerticalStackLayout Grid.Column="1" Margin="0,0,0,0" Spacing="2">
                            <Label Text="Jezik" FontSize="16" FontAttributes="Bold" TextColor="Black"/>
                            <Label Text="Bosanski" FontSize="14" TextColor="#666666"/>
                            <Label Text="{Binding CurrentLanguage}" TextColor="#666666" FontSize="14"/>
                        </VerticalStackLayout>
                        <Image Source="chevron_right.png"
                               WidthRequest="20"
                               HeightRequest="20"
                               Grid.Column="2"
                               HorizontalOptions="End"
                               VerticalOptions="Center"/>
                        <Grid.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding SelectLanguageCommand}"/>
                        </Grid.GestureRecognizers>
                    </Grid>
                </Frame>

              
                <!-- Notifications Card -->
                <Frame Style="{StaticResource CardFrameStyle}">
                    <Grid Style="{StaticResource CardGrid}">
                        <Image Source="bell.png"
                               WidthRequest="24"
                               HeightRequest="24"
                               Grid.Column="0"
                               VerticalOptions="Center"/>
                        <VerticalStackLayout Grid.Column="1" Spacing="2">
                            <Label Text="Notifikacije" FontSize="16" FontAttributes="Bold" TextColor="Black"/>
                            <Label Text="Obavjesti o kašnjenju i ažuriranja" FontSize="14" TextColor="#666666"/>
                        </VerticalStackLayout>
                        <Switch Grid.Column="2"
                                IsToggled="{Binding NotificationsEnabled, Mode=TwoWay}"
                                VerticalOptions="Center"
                                HorizontalOptions="End"/>
                    </Grid>
                </Frame>

                <!-- About Card -->
                <Frame Style="{StaticResource CardFrameStyle}">
                    <Grid Style="{StaticResource CardGrid}">
                        <Image Source="info.png"
                               WidthRequest="24"
                               HeightRequest="24"
                               Grid.Column="0"
                               VerticalOptions="Center"/>
                        <VerticalStackLayout Grid.Column="1" Spacing="2">
                            <Label Text="About" FontSize="16" FontAttributes="Bold" TextColor="Black"/>
                            <Label Text="Version 1.0" FontSize="14" TextColor="#666666"/>
                        </VerticalStackLayout>
                        <Image Source="chevron_right.png"
                               WidthRequest="20"
                               HeightRequest="20"
                               Grid.Column="2"
                               HorizontalOptions="End"
                               VerticalOptions="Center"/>
                        <Grid.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ShowAboutCommand}"/>
                        </Grid.GestureRecognizers>
                    </Grid>
                </Frame>

            </VerticalStackLayout>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
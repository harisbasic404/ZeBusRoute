<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:ZeBusRoute.ViewModels"
             xmlns:models="clr-namespace:ZeBusRoute.Models"
             x:Class="ZeBusRoute.Pages.RoutesPage"
             Title="Linije">

    <ContentPage.BindingContext>
        <vm:RoutesViewModel />
    </ContentPage.BindingContext>

    <Grid>
        <!-- Lista linija -->
        <ScrollView IsVisible="{Binding JeListaLinijaVidljiva}">
            <VerticalStackLayout Spacing="0">
                <!-- Header -->
                <Grid BackgroundColor="#8BC34A" Padding="20,15">
                    <HorizontalStackLayout Spacing="10">
                        <Label 
                               FontFamily="FontAwesome" 
                               FontSize="28" 
                               TextColor="White" 
                               VerticalOptions="Center"/>
                        <Label Text="Linije i Redovi Vožnje" 
                               FontSize="24" 
                               FontAttributes="Bold" 
                               TextColor="White" 
                               VerticalOptions="Center"/>
                    </HorizontalStackLayout>
                </Grid>

                <Label Text="Prijavi se da dodaš favorite"
                       Padding="20,10,20,0"
                       FontAttributes="Italic"
                       TextColor="#9E9E9E"
                       IsVisible="{Binding PrijavaNedostaje}" />

                <!-- Filtri -->
                <VerticalStackLayout Padding="20" Spacing="15" BackgroundColor="White">
                    <!-- Day Type Filter -->
                    <Label Text="Tip Dana" 
                           FontSize="16" 
                           TextColor="#9E9E9E" 
                           Margin="0,0,0,10"/>
                    
                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="10">
                        <Button Grid.Column="0"
                                Text="Radni dan"
                                BackgroundColor="{Binding RadniDanBojaPositine}"
                                TextColor="{Binding RadniDanBojaTeksta}"
                                CornerRadius="20"
                                Command="{Binding OdaberiTipDanaCommand}"
                                CommandParameter="RadniDan"/>
                           
                        <Button Grid.Column="1"
                                Text="Vikend"
                                BackgroundColor="{Binding VikendBojaPositine}"
                                TextColor="{Binding VikendBojaTeksta}"
                                CornerRadius="20"
                                Command="{Binding OdaberiTipDanaCommand}"
                                CommandParameter="Vikend"/>
                        
                        <Button Grid.Column="2"
                                Text="Praznik"
                                BackgroundColor="{Binding PraznikBojaPositine}"
                                TextColor="{Binding PraznikBojaTeksta}"
                                CornerRadius="20"
                                Command="{Binding OdaberiTipDanaCommand}"
                                CommandParameter="Praznik"/>
                    </Grid>

                    <!-- Time of Day Filter -->
                    <Label Text="Doba Dana" 
                           FontSize="16" 
                           TextColor="#9E9E9E" 
                           Margin="0,10,0,10"/>
                    
                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="10">
                        <Button Grid.Column="0"
                                Text="Jutro"
                                BackgroundColor="{Binding JutroBojaPositine}"
                                TextColor="{Binding JutroBojaTeksta}"
                                CornerRadius="20"
                                FontSize="14"
                                Command="{Binding OdaberiVrijemeUDanu}"
                                CommandParameter="Jutro"/>
                        
                        <Button Grid.Column="1"
                                Text="Podne"
                                BackgroundColor="{Binding PodneBojaPositine}"
                                TextColor="{Binding PodneBojaTeksta}"
                                CornerRadius="20"
                                FontSize="14"
                                Command="{Binding OdaberiVrijemeUDanu}"
                                CommandParameter="Podne"/>
                        
                        <Button Grid.Column="2"
                                Text="Večer"
                                BackgroundColor="{Binding VecerBojaPositine}"
                                TextColor="{Binding VecerBojaTeksta}"
                                CornerRadius="20"
                                FontSize="14"
                                Command="{Binding OdaberiVrijemeUDanu}"
                                CommandParameter="Vecer"/>
                    </Grid>
                </VerticalStackLayout>

                <!-- Available Lines -->
                <VerticalStackLayout Padding="20,10" Spacing="0" BackgroundColor="#F5F5F5">
                    <Label Text="Dostupne Linije" 
                           FontSize="18" 
                           TextColor="#9E9E9E" 
                           Margin="0,10,0,15"/>

                    <CollectionView ItemsSource="{Binding FiltriraneLinije}"
                                    SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:Linija">
                                <Frame Padding="0" 
                                       Margin="0,0,0,15" 
                                       BackgroundColor="White" 
                                       CornerRadius="15" 
                                       HasShadow="True">
                                    <Grid Padding="20" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="15">
                                        <!-- Line Number Badge -->
                                        <Frame Grid.Column="0"
                                               BackgroundColor="#8BC34A"
                                               WidthRequest="60"
                                               HeightRequest="60"
                                               CornerRadius="30"
                                               Padding="0"
                                               HasShadow="False"
                                               HorizontalOptions="Center"
                                               VerticalOptions="Center">
                                            <Label Text="{Binding Id}" 
                                                   FontSize="28" 
                                                   FontAttributes="Bold" 
                                                   TextColor="White" 
                                                   HorizontalOptions="Center" 
                                                   VerticalOptions="Center"/>  
                                        </Frame>

                                        <!-- Line Info (sa TapGestureRecognizer) -->
                                        <VerticalStackLayout Grid.Column="1" 
                                                             VerticalOptions="Center" 
                                                             Spacing="5">
                                            <VerticalStackLayout.GestureRecognizers>
                                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:RoutesViewModel}}, Path=OdaberiLinijuCommand}"
                                                                      CommandParameter="{Binding .}"/>
                                            </VerticalStackLayout.GestureRecognizers>
                                            
                                            <Label Text="{Binding Naziv}" 
                                                   FontSize="20" 
                                                   FontAttributes="Bold" 
                                                   TextColor="#424242"/>
                                            <Label Text="{Binding Smjer}" 
                                                   FontSize="14" 
                                                   TextColor="#9E9E9E"/>
                                        </VerticalStackLayout>

                                        <!-- Dugme za omiljene -->
                                        <ImageButton Grid.Column="2"
                                                     Source="{Binding IkonicaOmiljenog}"
                                                     BackgroundColor="Transparent"
                                                     WidthRequest="40"
                                                     HeightRequest="40"
                                                     Aspect="AspectFit"
                                                     VerticalOptions="Center"
                                                     Command="{Binding Source={RelativeSource AncestorType={x:Type vm:RoutesViewModel}}, Path=PrebacioOmiljenoCommand}"
                                                     CommandParameter="{Binding .}"
                                                     IsEnabled="{Binding Source={RelativeSource AncestorType={x:Type vm:RoutesViewModel}}, Path=IsUserLoggedIn}"
                                                     Opacity="{Binding Source={RelativeSource AncestorType={x:Type vm:RoutesViewModel}}, Path=IsUserLoggedIn, Converter={StaticResource BoolToOpacityConverter}}"
                                                     SemanticProperties.Hint="Dodaj u favorite"/>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </VerticalStackLayout>
        </ScrollView>

        <!-- Raspored View (ako postoji) -->
        <!-- ... ostali kod ... -->
    </Grid>
</ContentPage>
